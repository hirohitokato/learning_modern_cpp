# スマートポインタのポイント

## スマートポインタを使うタイミング

* ローカル変数
    * 関数内でnew/deleteしているものはstd::unique_ptrに置き換える
    * deleteの呼び忘れがなくなる
* ファクトリー関数
    * オブジェクトを作って返すファクトリー関数は、std::unique_ptrを返すと良い
    * 受け取り側はそのままオブジェクトを安全に管理できる上に、必要に応じて std::shared_ptr や生ポインターへ変換できる
* クラスが所有するオブジェクト
    * オブジェクトを所有しているのであればスマートポインタに置き換え。
    * デストラクタでdeleteしているメンバー変数はスマートポインタに置き換えられる場合が多い。
    * 基本的にstd::unique_ptrを使い、必要に応じてstd::shared_ptrにする
* オブジェクトの所有権を移す関数引数
    * 引数のポインターが所有権の移動を伴うものはstd::unique_ptrを使って表明する
    * コードを読んだ時に所有権の移動有無について悩まなくてよくなるため

## スマートポインタを使うべきでないタイミング

* 所有権がない場合
    * 自分でdeleteしてはいけないオブジェクト。スマートポインターにせず普通のポインターか参照を使う。
* 所有権を移動しない関数引数
    * 引数がスマートポインタだと所有権の移動を連想させてしまう。普通のポインターか参照を使いましょう。
* 配列や文字列
    * スマートポインターを使うことはできる。しかしstd::vectorやstd::stringを使ったほうがずっと良い。

## スマートポインタ移行時のポイント

* 生ポインターをスマートポインターに置き換える場合、delete しているオブジェクトを対象にすると比較的安全に進められる
    * new したオブジェクトを自分が所有しないことはあるが、所有していないオブジェクトをdeleteすることはないため

## 参考

* https://zenn.dev/tetsurom/books/restart-cpp11/viewer/smart-pointer#%E3%82%B9%E3%83%9E%E3%83%BC%E3%83%88%E3%83%9D%E3%82%A4%E3%83%B3%E3%82%BF%E3%82%92%E3%81%84%E3%81%A4%E4%BD%BF%E3%81%86%E3%81%8B
